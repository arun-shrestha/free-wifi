(function(){angular.module("freeWifiApp",["ngRoute","ngSanitize","ui.bootstrap"]);function e(e,t){e.when("/",{templateUrl:"/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"/common/views/genericText.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/location/:locationid",{templateUrl:"/locationDetail/locationDetail.view.html",controller:"locationDetailCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode(true)}angular.module("freeWifiApp").config(["$routeProvider","$locationProvider",e])})();(function(){angular.module("freeWifiApp").controller("homeCtrl",e);e.$inject=["$scope","freeWifiData","geolocation"];function e(e,t,o){if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}var i=this;console.log(window.location);i.pageHeader={title:"Free-Wifi",strapline:"Find places to work with wifi near you!"};i.sidebar={content:"Looking for wifi and a seat? Free-Wifi helps you find places to work when out and about. Perhaps with coffee, cake or a pint? Let Free-Wifi help you find the place you're looking for."};i.message="Checking your location";i.getData=function(e){var o=e.coords.latitude,n=e.coords.longitude;i.message="Searching for nearby places";t.locationByCoords(o,n).success(function(e){i.message=e.length>0?"":"No locations found nearby";i.data={locations:e};console.log(i.data)}).error(function(e){i.message="Sorry, something's gone wrong, please try again later"})};i.showError=function(t){e.$apply(function(){i.message=t.message})};i.noGeo=function(){e.$apply(function(){i.message="Geolocation is not supported by this browser."})};o.getPosition(i.getData,i.showError,i.noGeo)}})();(function(){angular.module("freeWifiApp").controller("aboutCtrl",e);function e(){var e=this;e.pageHeader={title:"About Free-Wifi"};e.main={content:"Free-Wifi is created to help people find places to sit down and get a bit of work done. You can contribute to this site by simply giving your review and rating on the businesses that are listed here. If you are a service provider with free wifi to share, you can improve your exprosure by adding details of your business in our page. \n\nLorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc sed lorem ac nisi dignissim accumsan. Nullam sit amet interdum magna. Morbi quis faucibus nisi. Vestibulum mollis purus quis eros adipiscing tristique. Proin posuere semper tellus, id placerat augue dapibus ornare. Aenean leo metus, tempus in nisl eget, accumsan interdum dui. Pellentesque sollicitudin volutpat ullamcorper."}}})();(function(){angular.module("freeWifiApp").controller("loginCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var o=this;o.pageHeader={title:"Sign in to Free-Wifi"};o.credentials={email:"",password:""};o.returnPage=e.search().page||"/";o.onSubmit=function(){o.formError="";if(!o.credentials.email||!o.credentials.password){o.formError="All fields required, please try again";return false}else{o.doLogin()}};o.doLogin=function(){o.formError="";t.login(o.credentials).error(function(e){o.formError=e}).then(function(){e.search("page",null);e.path(o.returnPage)})}}})();(function(){angular.module("freeWifiApp").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var o=this;o.pageHeader={title:"Create a new Free-Wifi account"};o.credentials={name:"",email:"",password:""};o.returnPage=e.search().page||"/";o.onSubmit=function(){};o.onSubmit=function(){o.formError="";if(!o.credentials.name||!o.credentials.email||!o.credentials.password){o.formError="All fields required, please try again";return false}else{o.doRegister()}};o.doRegister=function(){o.formError="";t.register(o.credentials).error(function(e){o.formError=e}).then(function(){e.search("page",null);e.path(o.returnPage)})}}})();(function(){angular.module("freeWifiApp").controller("locationDetailCtrl",e);e.$inject=["$routeParams","$location","$modal","freeWifiData","authentication"];function e(e,t,o,i,n){var r=this;r.locationid=e.locationid;r.isLoggedIn=n.isLoggedIn();r.currentPath=t.path();i.locationById(r.locationid).success(function(e){r.data={location:e};r.pageHeader={title:r.data.location.name}}).error(function(e){console.log(e)});r.popupReviewForm=function(){var e=o.open({templateUrl:"/reviewModal/reviewModal.view.html",controller:"reviewModalCtrl as vm",resolve:{locationData:function(){return{locationid:r.locationid,locationName:r.data.location.name}}}});e.result.then(function(e){r.data.location.reviews.push(e)})}}})();(function(){angular.module("freeWifiApp").controller("reviewModalCtrl",e);e.$inject=["$modalInstance","freeWifiData","locationData"];function e(e,t,o){var i=this;i.locationData=o;i.onSubmit=function(){i.formError="";if(!i.formData.rating||!i.formData.reviewText){i.formError="All fields required, please try again";return false}else{i.doAddReview(i.locationData.locationid,i.formData)}};i.doAddReview=function(e,o){t.addReviewById(e,{rating:o.rating,reviewText:o.reviewText}).success(function(e){i.modal.close(e)}).error(function(e){i.formError="Your review has not been saved, please try again"});return false};i.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("freeWifiApp").service("authentication",e);e.$inject=["$http","$window"];function e(e,t){var o=function(e){t.localStorage["freeWifi-token"]=e};var i=function(){return t.localStorage["freeWifi-token"]};var n=function(){var e=i();if(e){var o=JSON.parse(t.atob(e.split(".")[1]));return o.exp>Date.now()/1e3}else{return false}};var r=function(){if(n()){var e=i();var o=JSON.parse(t.atob(e.split(".")[1]));return{email:o.email,name:o.name}}};register=function(t){return e.post("/api/register",t).success(function(e){o(e.token)})};login=function(t){return e.post("/api/login",t).success(function(e){o(e.token)})};logout=function(){t.localStorage.removeItem("freeWifi-token")};return{currentUser:r,saveToken:o,getToken:i,isLoggedIn:n,register:register,login:login,logout:logout}}})();(function(){angular.module("freeWifiApp").service("geolocation",e);function e(){var e=function(e,t,o){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,t)}else{o()}};return{getPosition:e}}})();(function(){angular.module("freeWifiApp").service("freeWifiData",e);e.$inject=["$http","authentication"];function e(e,t){var o=function(t,o){return e.get("/api/locations?lng="+o+"&lat="+t+"&maxDistance=20")};var i=function(t){return e.get("/api/locations/"+t)};var n=function(o,i){return e.post("/api/locations/"+o+"/reviews",i,{headers:{Authorization:"Bearer "+t.getToken()}})};return{locationByCoords:o,locationById:i,addReviewById:n}}})();(function(){angular.module("freeWifiApp").filter("formatDistance",t);var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};function t(){return function(t){var o,i;if(t&&e(t)){if(t>1){o=parseFloat(t).toFixed(1);i="km"}else{o=parseInt(t*1e3,10);i="m"}return o+i}else{return"?"}}}})();(function(){angular.module("freeWifiApp").filter("addHtmlLineBreaks",e);function e(){return function(e){var t=e.replace(/\n/g,"<br/>");return t}}})();(function(){angular.module("freeWifiApp").controller("navigationCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var o=this;o.currentPath=e.path();o.isLoggedIn=t.isLoggedIn();o.currentUser=t.currentUser();o.logout=function(){t.logout();e.path("#/")}}})();(function(){angular.module("freeWifiApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("freeWifiApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("freeWifiApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();(function(){angular.module("freeWifiApp").directive("ratingStars",e);function e(){return{restrict:"EA",scope:{thisRating:"=rating"},templateUrl:"/common/directives/ratingStars/ratingStars.template.html"}}})();